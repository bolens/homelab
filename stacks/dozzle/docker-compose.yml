# Portainer-friendly: no host bind mounts (except Docker socket), env defaults, external monitor network.
# Deploy as stack in Portainer or via `docker compose up -d`. Set DOZZLE_HOST_PORT / TZ in stack env if needed.
# Dozzle v10+ auth: uncomment dozzle_config volume and add users.yaml into that volume (e.g. via Portainer volume browser).
services:
  dozzle:
    image: amir20/dozzle:latest
    container_name: dozzle
    restart: unless-stopped
    stop_grace_period: 30s   # Dozzle needs time to close log streams; default 10s can cause "failed to shut down"
    ports:
      - "${DOZZLE_HOST_PORT:-8082}:8080"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - dozzle_config:/data   # required for auth: put users.yaml in this volume and set DOZZLE_AUTH_PROVIDER=simple
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - default
      - monitor
    environment:
      - TZ=${TZ:-America/Denver}
      - LANG=${LANG:-en_US.UTF-8}
      - LC_ALL=${LC_ALL:-en_US.UTF-8}
      - LC_CTYPE=${LC_CTYPE:-en_US.UTF-8}
      - DOZZLE_AUTH_PROVIDER=${DOZZLE_AUTH_PROVIDER:-simple}

networks:
  monitor:
    name: monitor
    external: true

volumes:
  dozzle_config: {}   # used only if you uncomment dozzle_config mount above for auth
