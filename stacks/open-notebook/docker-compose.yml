# Open Notebook - Open Source Notebook LM alternative
# Requires SurrealDB for data storage. No host ports: access via Caddy on monitor network.
services:
  surrealdb:
    image: surrealdb/surrealdb:v2
    container_name: open-notebook-surrealdb
    restart: unless-stopped
    user: "0:0"  # required: image runs non-root but needs write access to volume
    command: start --log info --user ${SURREAL_USER:-root} --pass ${SURREAL_PASSWORD:-root} rocksdb:/mydata/mydatabase.db
    # No host port: internal only (open_notebook connects via Docker network)
    volumes:
      - surrealdb_data:/mydata
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - default
      - monitor
    environment:
      - TZ=${TZ:-America/Denver}
      - LANG=${LANG:-en_US.UTF-8}
      - LC_ALL=${LC_ALL:-en_US.UTF-8}
      - LC_CTYPE=${LC_CTYPE:-en_US.UTF-8}

  open_notebook:
    image: lfnovo/open_notebook:v1-latest
    container_name: open-notebook
    restart: unless-stopped
    # No host ports: access via Caddy (open-notebook.home / open-notebook.bolens.dev on monitor network)
    volumes:
      - open_notebook_data:/app/data
    depends_on:
      - surrealdb
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - default
      - monitor
    environment:
      - TZ=${TZ:-America/Denver}
      - LANG=${LANG:-en_US.UTF-8}
      - LC_ALL=${LC_ALL:-en_US.UTF-8}
      - LC_CTYPE=${LC_CTYPE:-en_US.UTF-8}
      - OPEN_NOTEBOOK_ENCRYPTION_KEY=${OPEN_NOTEBOOK_ENCRYPTION_KEY:-change-me-to-a-secret-string}
      - OPEN_NOTEBOOK_PASSWORD=${OPEN_NOTEBOOK_PASSWORD:-}
      - SURREAL_URL=ws://surrealdb:8000/rpc
      - SURREAL_USER=${SURREAL_USER:-root}
      - SURREAL_PASSWORD=${SURREAL_PASSWORD:-root}
      - SURREAL_NAMESPACE=${SURREAL_NAMESPACE:-open_notebook}
      - SURREAL_DATABASE=${SURREAL_DATABASE:-open_notebook}
      - API_URL=${API_URL:-https://notebook.bolens.dev}
      - OLLAMA_BASE_URL=${OLLAMA_BASE_URL:-http://host.docker.internal:11434}

networks:
  monitor:
    name: monitor
    external: true

volumes:
  surrealdb_data:
  open_notebook_data:
